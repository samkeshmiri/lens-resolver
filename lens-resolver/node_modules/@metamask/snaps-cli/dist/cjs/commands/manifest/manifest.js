"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "manifestHandler", {
    enumerable: true,
    get: function() {
        return manifestHandler;
    }
});
const _snapsutils = require("@metamask/snaps-utils");
const _errors = require("../../errors");
const _utils = require("../../utils");
const _implementation = require("./implementation");
const steps = [
    {
        name: 'Checking the input file.',
        task: async ({ input })=>{
            if (!await (0, _snapsutils.isFile)(input)) {
                throw new _errors.CommandError(`Manifest file not found: "${input}". Make sure that the \`snap.manifest.json\` file exists.`);
            }
        }
    },
    {
        name: 'Validating the snap manifest.',
        task: async ({ input, config, options, spinner })=>{
            const write = getWriteManifest(config, options);
            const valid = await (0, _implementation.manifest)(input, write, spinner);
            if (valid) {
                spinner.succeed('The snap manifest file is valid.');
            }
        }
    }
];
/**
 * Get whether to write the manifest to disk.
 *
 * @param config - The config object.
 * @param options - The options object.
 * @returns Whether to write the manifest to disk.
 */ function getWriteManifest(config, options) {
    if (typeof options.fix === 'boolean') {
        return options.fix;
    }
    return config.legacy?.writeManifest ?? false;
}
async function manifestHandler(config, options) {
    await (0, _utils.executeSteps)(steps, {
        input: config.manifest.path,
        config,
        options
    });
}

//# sourceMappingURL=manifest.js.map