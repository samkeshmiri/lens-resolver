{"version":3,"sources":["../../../../src/commands/watch/watch.ts"],"sourcesContent":["import { isFile } from '@metamask/snaps-utils';\n\nimport type { ProcessedConfig, ProcessedWebpackConfig } from '../../config';\nimport { CommandError } from '../../errors';\nimport type { Steps } from '../../utils';\nimport { executeSteps, info } from '../../utils';\nimport { getServer } from '../../webpack';\nimport { watch } from './implementation';\n\ntype WatchOptions = {\n  /**\n   * The port to listen on.\n   */\n  port?: number;\n};\n\ntype WatchContext = {\n  config: ProcessedWebpackConfig;\n  options: WatchOptions;\n};\n\nconst steps: Steps<WatchContext> = [\n  {\n    name: 'Checking the input file.',\n    task: async ({ config }) => {\n      const { input } = config;\n\n      if (!(await isFile(input))) {\n        throw new CommandError(\n          `Input file not found: \"${input}\". Make sure that the \"input\" field in your snap config is correct.`,\n        );\n      }\n    },\n  },\n  {\n    name: 'Starting the development server.',\n    condition: ({ config }) => config.server.enabled,\n    task: async ({ config, options, spinner }) => {\n      const server = getServer(config);\n      const { port } = await server.listen(options.port ?? config.server.port);\n\n      info(`The server is listening on http://localhost:${port}.`, spinner);\n    },\n  },\n  {\n    name: 'Building the snap bundle.',\n    task: async ({ config, spinner }) => {\n      await watch(config, { spinner });\n    },\n  },\n];\n\n/**\n * Watch a directory and its subdirectories for changes, and build when files\n * are added or changed.\n *\n * Ignores 'node_modules' and dotfiles.\n * Creates destination directory if it doesn't exist.\n *\n * @param config - The config object.\n * @param options - The options object.\n */\nexport async function watchHandler(\n  config: ProcessedConfig,\n  options: WatchOptions,\n): Promise<void> {\n  await executeSteps(steps, { config, options });\n}\n"],"names":["isFile","CommandError","executeSteps","info","getServer","watch","steps","name","task","config","input","condition","server","enabled","options","spinner","port","listen","watchHandler"],"mappings":"AAAA,SAASA,MAAM,QAAQ,wBAAwB;AAG/C,SAASC,YAAY,QAAQ,eAAe;AAE5C,SAASC,YAAY,EAAEC,IAAI,QAAQ,cAAc;AACjD,SAASC,SAAS,QAAQ,gBAAgB;AAC1C,SAASC,KAAK,QAAQ,mBAAmB;AAczC,MAAMC,QAA6B;IACjC;QACEC,MAAM;QACNC,MAAM,OAAO,EAAEC,MAAM,EAAE;YACrB,MAAM,EAAEC,KAAK,EAAE,GAAGD;YAElB,IAAI,CAAE,MAAMT,OAAOU,QAAS;gBAC1B,MAAM,IAAIT,aACR,CAAC,uBAAuB,EAAES,MAAM,mEAAmE,CAAC;YAExG;QACF;IACF;IACA;QACEH,MAAM;QACNI,WAAW,CAAC,EAAEF,MAAM,EAAE,GAAKA,OAAOG,MAAM,CAACC,OAAO;QAChDL,MAAM,OAAO,EAAEC,MAAM,EAAEK,OAAO,EAAEC,OAAO,EAAE;YACvC,MAAMH,SAASR,UAAUK;YACzB,MAAM,EAAEO,IAAI,EAAE,GAAG,MAAMJ,OAAOK,MAAM,CAACH,QAAQE,IAAI,IAAIP,OAAOG,MAAM,CAACI,IAAI;YAEvEb,KAAK,CAAC,4CAA4C,EAAEa,KAAK,CAAC,CAAC,EAAED;QAC/D;IACF;IACA;QACER,MAAM;QACNC,MAAM,OAAO,EAAEC,MAAM,EAAEM,OAAO,EAAE;YAC9B,MAAMV,MAAMI,QAAQ;gBAAEM;YAAQ;QAChC;IACF;CACD;AAED;;;;;;;;;CASC,GACD,OAAO,eAAeG,aACpBT,MAAuB,EACvBK,OAAqB;IAErB,MAAMZ,aAAaI,OAAO;QAAEG;QAAQK;IAAQ;AAC9C"}