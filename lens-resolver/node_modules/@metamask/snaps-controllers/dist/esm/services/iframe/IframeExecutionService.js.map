{"version":3,"sources":["../../../../src/services/iframe/IframeExecutionService.ts"],"sourcesContent":["import type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { WindowPostMessageStream } from '@metamask/post-message-stream';\nimport { createWindow } from '@metamask/snaps-utils';\n\nimport type { Job, ExecutionServiceArgs } from '../AbstractExecutionService';\nimport { AbstractExecutionService } from '../AbstractExecutionService';\n\ntype IframeExecutionEnvironmentServiceArgs = {\n  iframeUrl: URL;\n} & ExecutionServiceArgs;\n\nexport class IframeExecutionService extends AbstractExecutionService<Window> {\n  public iframeUrl: URL;\n\n  constructor({\n    iframeUrl,\n    messenger,\n    setupSnapProvider,\n  }: IframeExecutionEnvironmentServiceArgs) {\n    super({\n      messenger,\n      setupSnapProvider,\n    });\n    this.iframeUrl = iframeUrl;\n  }\n\n  protected terminateJob(jobWrapper: Job<Window>): void {\n    document.getElementById(jobWrapper.id)?.remove();\n  }\n\n  protected async initEnvStream(jobId: string): Promise<{\n    worker: Window;\n    stream: BasePostMessageStream;\n  }> {\n    const iframeWindow = await createWindow(this.iframeUrl.toString(), jobId);\n\n    const stream = new WindowPostMessageStream({\n      name: 'parent',\n      target: 'child',\n      targetWindow: iframeWindow,\n      targetOrigin: '*',\n    });\n\n    return { worker: iframeWindow, stream };\n  }\n}\n"],"names":["WindowPostMessageStream","createWindow","AbstractExecutionService","IframeExecutionService","terminateJob","jobWrapper","document","getElementById","id","remove","initEnvStream","jobId","iframeWindow","iframeUrl","toString","stream","name","target","targetWindow","targetOrigin","worker","constructor","messenger","setupSnapProvider"],"mappings":";;;;;;;;;;;;;AACA,SAASA,uBAAuB,QAAQ,gCAAgC;AACxE,SAASC,YAAY,QAAQ,wBAAwB;AAGrD,SAASC,wBAAwB,QAAQ,8BAA8B;AAMvE,OAAO,MAAMC,+BAA+BD;IAehCE,aAAaC,UAAuB,EAAQ;QACpDC,SAASC,cAAc,CAACF,WAAWG,EAAE,GAAGC;IAC1C;IAEA,MAAgBC,cAAcC,KAAa,EAGxC;QACD,MAAMC,eAAe,MAAMX,aAAa,IAAI,CAACY,SAAS,CAACC,QAAQ,IAAIH;QAEnE,MAAMI,SAAS,IAAIf,wBAAwB;YACzCgB,MAAM;YACNC,QAAQ;YACRC,cAAcN;YACdO,cAAc;QAChB;QAEA,OAAO;YAAEC,QAAQR;YAAcG;QAAO;IACxC;IA9BAM,YAAY,EACVR,SAAS,EACTS,SAAS,EACTC,iBAAiB,EACqB,CAAE;QACxC,KAAK,CAAC;YACJD;YACAC;QACF;QAVF,uBAAOV,aAAP,KAAA;QAWE,IAAI,CAACA,SAAS,GAAGA;IACnB;AAqBF"}