{"version":3,"sources":["../../../../src/services/node/NodeProcessExecutionService.ts"],"sourcesContent":["import type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { ProcessParentMessageStream } from '@metamask/post-message-stream';\nimport type { ChildProcess } from 'child_process';\nimport { fork } from 'child_process';\n\nimport type { Job } from '..';\nimport { AbstractExecutionService } from '..';\n\nexport class NodeProcessExecutionService extends AbstractExecutionService<ChildProcess> {\n  protected async initEnvStream(): Promise<{\n    worker: ChildProcess;\n    stream: BasePostMessageStream;\n  }> {\n    const worker = fork(\n      require.resolve(\n        '@metamask/snaps-execution-environments/dist/browserify/node-process/bundle.js',\n      ),\n    );\n\n    const stream = new ProcessParentMessageStream({ process: worker });\n    return Promise.resolve({ worker, stream });\n  }\n\n  protected terminateJob(jobWrapper: Job<ChildProcess>): void {\n    jobWrapper.worker.kill();\n  }\n}\n"],"names":["ProcessParentMessageStream","fork","AbstractExecutionService","NodeProcessExecutionService","initEnvStream","worker","require","resolve","stream","process","Promise","terminateJob","jobWrapper","kill"],"mappings":"AACA,SAASA,0BAA0B,QAAQ,gCAAgC;AAE3E,SAASC,IAAI,QAAQ,gBAAgB;AAGrC,SAASC,wBAAwB,QAAQ,KAAK;AAE9C,OAAO,MAAMC,oCAAoCD;IAC/C,MAAgBE,gBAGb;QACD,MAAMC,SAASJ,KACbK,QAAQC,OAAO,CACb;QAIJ,MAAMC,SAAS,IAAIR,2BAA2B;YAAES,SAASJ;QAAO;QAChE,OAAOK,QAAQH,OAAO,CAAC;YAAEF;YAAQG;QAAO;IAC1C;IAEUG,aAAaC,UAA6B,EAAQ;QAC1DA,WAAWP,MAAM,CAACQ,IAAI;IACxB;AACF"}