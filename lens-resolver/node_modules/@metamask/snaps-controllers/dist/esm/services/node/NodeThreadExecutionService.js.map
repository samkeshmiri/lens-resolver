{"version":3,"sources":["../../../../src/services/node/NodeThreadExecutionService.ts"],"sourcesContent":["import type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { ThreadParentMessageStream } from '@metamask/post-message-stream';\n// eslint-disable-next-line @typescript-eslint/no-shadow\nimport { Worker } from 'worker_threads';\n\nimport type { Job } from '..';\nimport { AbstractExecutionService } from '..';\n\nexport class NodeThreadExecutionService extends AbstractExecutionService<Worker> {\n  protected async initEnvStream(): Promise<{\n    worker: Worker;\n    stream: BasePostMessageStream;\n  }> {\n    const worker = new Worker(\n      require.resolve(\n        '@metamask/snaps-execution-environments/dist/browserify/node-thread/bundle.js',\n      ),\n    );\n    const stream = new ThreadParentMessageStream({ thread: worker });\n    return Promise.resolve({ worker, stream });\n  }\n\n  protected async terminateJob(jobWrapper: Job<Worker>): Promise<void> {\n    await jobWrapper.worker.terminate();\n  }\n}\n"],"names":["ThreadParentMessageStream","Worker","AbstractExecutionService","NodeThreadExecutionService","initEnvStream","worker","require","resolve","stream","thread","Promise","terminateJob","jobWrapper","terminate"],"mappings":"AACA,SAASA,yBAAyB,QAAQ,gCAAgC;AAC1E,wDAAwD;AACxD,SAASC,MAAM,QAAQ,iBAAiB;AAGxC,SAASC,wBAAwB,QAAQ,KAAK;AAE9C,OAAO,MAAMC,mCAAmCD;IAC9C,MAAgBE,gBAGb;QACD,MAAMC,SAAS,IAAIJ,OACjBK,QAAQC,OAAO,CACb;QAGJ,MAAMC,SAAS,IAAIR,0BAA0B;YAAES,QAAQJ;QAAO;QAC9D,OAAOK,QAAQH,OAAO,CAAC;YAAEF;YAAQG;QAAO;IAC1C;IAEA,MAAgBG,aAAaC,UAAuB,EAAiB;QACnE,MAAMA,WAAWP,MAAM,CAACQ,SAAS;IACnC;AACF"}