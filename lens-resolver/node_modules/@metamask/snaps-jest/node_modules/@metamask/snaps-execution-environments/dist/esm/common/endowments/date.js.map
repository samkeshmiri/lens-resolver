{"version":3,"sources":["../../../../src/common/endowments/date.ts"],"sourcesContent":["import { rootRealmGlobal } from '../globalObject';\n\n/**\n * Creates a {@link Date} constructor, with most of the same properties as the global object.\n * The Date.now() function has added noise as to limit its precision and prevent potential timing attacks.\n * The Date constructor uses this now() function to seed itself if no arguments are given to the constructor.\n *\n * @returns A modified {@link Date} constructor with limited precision.\n */\nfunction createDate() {\n  const keys = Object.getOwnPropertyNames(\n    rootRealmGlobal.Date,\n  ) as (keyof typeof Date)[];\n\n  let currentTime = 0;\n  const now = () => {\n    const actual = rootRealmGlobal.Date.now();\n    const newTime = Math.round(actual + Math.random());\n    if (newTime > currentTime) {\n      currentTime = newTime;\n    }\n    return currentTime;\n  };\n\n  const NewDate = function (...args: unknown[]) {\n    return Reflect.construct(\n      rootRealmGlobal.Date,\n      args.length === 0 ? [now()] : args,\n      new.target,\n    );\n  } as DateConstructor;\n\n  keys.forEach((key) => {\n    Reflect.defineProperty(NewDate, key, {\n      configurable: false,\n      writable: false,\n      value: key === 'now' ? now : rootRealmGlobal.Date[key],\n    });\n  });\n\n  return { Date: harden(NewDate) };\n}\n\nconst endowmentModule = {\n  names: ['Date'] as const,\n  factory: createDate,\n};\n\nexport default endowmentModule;\n"],"names":["rootRealmGlobal","createDate","keys","Object","getOwnPropertyNames","Date","currentTime","now","actual","newTime","Math","round","random","NewDate","args","Reflect","construct","length","forEach","key","defineProperty","configurable","writable","value","harden","endowmentModule","names","factory"],"mappings":"AAAA,SAASA,eAAe,QAAQ,kBAAkB;AAElD;;;;;;CAMC,GACD,SAASC;IACP,MAAMC,OAAOC,OAAOC,mBAAmB,CACrCJ,gBAAgBK,IAAI;IAGtB,IAAIC,cAAc;IAClB,MAAMC,MAAM;QACV,MAAMC,SAASR,gBAAgBK,IAAI,CAACE,GAAG;QACvC,MAAME,UAAUC,KAAKC,KAAK,CAACH,SAASE,KAAKE,MAAM;QAC/C,IAAIH,UAAUH,aAAa;YACzBA,cAAcG;QAChB;QACA,OAAOH;IACT;IAEA,MAAMO,UAAU,SAAU,GAAGC,IAAe;QAC1C,OAAOC,QAAQC,SAAS,CACtBhB,gBAAgBK,IAAI,EACpBS,KAAKG,MAAM,KAAK,IAAI;YAACV;SAAM,GAAGO,MAC9B;IAEJ;IAEAZ,KAAKgB,OAAO,CAAC,CAACC;QACZJ,QAAQK,cAAc,CAACP,SAASM,KAAK;YACnCE,cAAc;YACdC,UAAU;YACVC,OAAOJ,QAAQ,QAAQZ,MAAMP,gBAAgBK,IAAI,CAACc,IAAI;QACxD;IACF;IAEA,OAAO;QAAEd,MAAMmB,OAAOX;IAAS;AACjC;AAEA,MAAMY,kBAAkB;IACtBC,OAAO;QAAC;KAAO;IACfC,SAAS1B;AACX;AAEA,eAAewB,gBAAgB"}