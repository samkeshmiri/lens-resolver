{"version":3,"sources":["../../../../src/common/lockdown/lockdown-events.ts"],"sourcesContent":["// When creating a sandbox, limitation of the events from leaking\n// sensitive objects is required. This is done by overriding own properties\n// of prototypes of all existing events.\nimport { hasProperty } from '@metamask/utils';\n\n/**\n * Targeted Event objects and properties.\n * Note: This is a map of the prototypes that inherit from Events with\n * properties that are identified to leak sensitive objects.\n * Not all browsers support all event types, so checking its existence is required.\n */\nconst targetEvents = new Map();\nif (hasProperty(globalThis, 'UIEvent')) {\n  targetEvents.set(UIEvent.prototype, ['view']);\n}\nif (hasProperty(globalThis, 'MutationEvent')) {\n  targetEvents.set(MutationEvent.prototype, ['relatedNode']);\n}\nif (hasProperty(globalThis, 'MessageEvent')) {\n  targetEvents.set(MessageEvent.prototype, ['source']);\n}\nif (hasProperty(globalThis, 'FocusEvent')) {\n  targetEvents.set(FocusEvent.prototype, ['relatedTarget']);\n}\nif (hasProperty(globalThis, 'MouseEvent')) {\n  targetEvents.set(MouseEvent.prototype, [\n    'relatedTarget',\n    'fromElement',\n    'toElement',\n  ]);\n}\nif (hasProperty(globalThis, 'TouchEvent')) {\n  targetEvents.set(TouchEvent.prototype, ['targetTouches', 'touches']);\n}\nif (hasProperty(globalThis, 'Event')) {\n  targetEvents.set(Event.prototype, [\n    'target',\n    'currentTarget',\n    'srcElement',\n    'composedPath',\n  ]);\n}\n\n/**\n * Attenuate Event objects by replacing its own properties.\n */\nexport function executeLockdownEvents() {\n  targetEvents.forEach((properties, prototype) => {\n    for (const property of properties) {\n      Object.defineProperty(prototype, property, {\n        value: undefined,\n        configurable: false,\n        writable: false,\n      });\n    }\n  });\n}\n"],"names":["hasProperty","targetEvents","Map","globalThis","set","UIEvent","prototype","MutationEvent","MessageEvent","FocusEvent","MouseEvent","TouchEvent","Event","executeLockdownEvents","forEach","properties","property","Object","defineProperty","value","undefined","configurable","writable"],"mappings":"AAAA,iEAAiE;AACjE,2EAA2E;AAC3E,wCAAwC;AACxC,SAASA,WAAW,QAAQ,kBAAkB;AAE9C;;;;;CAKC,GACD,MAAMC,eAAe,IAAIC;AACzB,IAAIF,YAAYG,YAAY,YAAY;IACtCF,aAAaG,GAAG,CAACC,QAAQC,SAAS,EAAE;QAAC;KAAO;AAC9C;AACA,IAAIN,YAAYG,YAAY,kBAAkB;IAC5CF,aAAaG,GAAG,CAACG,cAAcD,SAAS,EAAE;QAAC;KAAc;AAC3D;AACA,IAAIN,YAAYG,YAAY,iBAAiB;IAC3CF,aAAaG,GAAG,CAACI,aAAaF,SAAS,EAAE;QAAC;KAAS;AACrD;AACA,IAAIN,YAAYG,YAAY,eAAe;IACzCF,aAAaG,GAAG,CAACK,WAAWH,SAAS,EAAE;QAAC;KAAgB;AAC1D;AACA,IAAIN,YAAYG,YAAY,eAAe;IACzCF,aAAaG,GAAG,CAACM,WAAWJ,SAAS,EAAE;QACrC;QACA;QACA;KACD;AACH;AACA,IAAIN,YAAYG,YAAY,eAAe;IACzCF,aAAaG,GAAG,CAACO,WAAWL,SAAS,EAAE;QAAC;QAAiB;KAAU;AACrE;AACA,IAAIN,YAAYG,YAAY,UAAU;IACpCF,aAAaG,GAAG,CAACQ,MAAMN,SAAS,EAAE;QAChC;QACA;QACA;QACA;KACD;AACH;AAEA;;CAEC,GACD,OAAO,SAASO;IACdZ,aAAaa,OAAO,CAAC,CAACC,YAAYT;QAChC,KAAK,MAAMU,YAAYD,WAAY;YACjCE,OAAOC,cAAc,CAACZ,WAAWU,UAAU;gBACzCG,OAAOC;gBACPC,cAAc;gBACdC,UAAU;YACZ;QACF;IACF;AACF"}